
-- 테이블 생성 SQL
CREATE TABLE `Goods` (
	`g_id`	int	NOT NULL,
	`c2_id`	int	NOT NULL,
	`m_number`	int	NOT NULL,
	`g_name`	varchar(255)	NULL,
	`g_price`	int	NOT NULL,
	`g_pic01`	varchar(255)	NULL,
	`g_pic02`	varchar(255)	NULL,
	`g_pic03`	varchar(255)	NULL,
	`g_picpath`	varchar(255)	NULL,
	`g_like`	int	NULL,
	`g_regdate`	DATETIME	NULL	DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE `Goods` ADD CONSTRAINT `PK_GOODS` PRIMARY KEY (
	`g_id`
);

ALTER TABLE `dongnae`.`Goods` 
CHANGE COLUMN `g_id` `g_id` INT NOT NULL AUTO_INCREMENT ;




CREATE TABLE `keyword` (
	`key_id`	int	NOT NULL,
	`m_number`	int	NOT NULL,
	`keyword`	varchar(255)	NOT NULL
);

ALTER TABLE `keyword` ADD CONSTRAINT `PK_KEYWORD` PRIMARY KEY (
	`key_id`
);

ALTER TABLE `dongnae`.`keyword` 
CHANGE COLUMN `key_id` `key_id` INT NOT NULL AUTO_INCREMENT ;



CREATE TABLE `category_goods_1` (
	`c1_id`	int	NOT NULL,
	`c1_category`	varchar(255)	NOT NULL
);

CREATE TABLE `category_goods_2` (
	`c2_id`	int	NOT NULL ,
	`c2_category`	varchar(255)	NOT NULL,
	`c1_id`	int	NOT NULL
);

ALTER TABLE `category_goods_1` ADD CONSTRAINT `PK_CATEGORY_GOODS_1` PRIMARY KEY (
	`c1_id`
);

ALTER TABLE `dongnae`.`category_goods_1` 
CHANGE COLUMN `c1_id` `c1_id` INT NOT NULL AUTO_INCREMENT ;

ALTER TABLE `category_goods_2` ADD CONSTRAINT `PK_CATEGORY_GOODS_2` PRIMARY KEY (
	`c2_id`
);

ALTER TABLE `dongnae`.`category_goods_2` 
CHANGE COLUMN `c2_id` `c2_id` INT NOT NULL AUTO_INCREMENT ;





-- 카테고리 목록
insert into category_goods_1 (c1_category) values ('수입명품');
insert into category_goods_1 (c1_category) values ('패션의류');
insert into category_goods_1 (c1_category) values ('패션잡화');
insert into category_goods_1 (c1_category) values ('뷰티');
insert into category_goods_1 (c1_category) values ('모바일/태블릿');
insert into category_goods_1 (c1_category) values ('가전제품');
insert into category_goods_1 (c1_category) values ('노트북/PC');
insert into category_goods_1 (c1_category) values ('카메라/캠코더');
insert into category_goods_1 (c1_category) values ('가구/인테리어');
insert into category_goods_1 (c1_category) values ('리빙/생활');
insert into category_goods_1 (c1_category) values ('게임');
insert into category_goods_1 (c1_category) values ('반려동물');
insert into category_goods_1 (c1_category) values ('도서/음반');
insert into category_goods_1 (c1_category) values ('스포츠');
insert into category_goods_1 (c1_category) values ('공구/산업용품');
insert into category_goods_1 (c1_category) values ('무료나눔');


-- community 테이블 --------------------------------------------

CREATE TABLE `category` (
  `ca_id` int NOT NULL AUTO_INCREMENT,
  `ca_l` varchar(255) NOT NULL,
  PRIMARY KEY (`ca_id`),
  UNIQUE KEY `ca_id_UNIQUE` (`ca_id`)
);

insert into category(ca_l)
values('사건사고');
insert into category(ca_l)
values('분실/실종');
insert into category(ca_l)
values('일상');
insert into category(ca_l)
values('맛집');
insert into category(ca_l)
values('취미');
insert into category(ca_l)
values('동네질문');


CREATE TABLE `comment` (
  `com_id` int NOT NULL AUTO_INCREMENT,
  `com_c` varchar(255) NOT NULL,
  `m_number` int NOT NULL,
  `mu_id` int NOT NULL,
  PRIMARY KEY (`com_id`),
  UNIQUE KEY `com_id_UNIQUE` (`com_id`)
);

CREATE TABLE `community` (
  `mu_id` int NOT NULL AUTO_INCREMENT,
  `mu_name` varchar(255) NOT NULL,
  `mu_detail` longtext NOT NULL,
  `mu_i1` varchar(255) DEFAULT NULL,
  `mu_i2` varchar(255) DEFAULT NULL,
  `mu_i3` varchar(255) DEFAULT NULL,
  `mu_c` int DEFAULT '0',
  `mu_data` datetime DEFAULT CURRENT_TIMESTAMP,
  `ca_id` int NOT NULL,
  `m_number` int NOT NULL,
  PRIMARY KEY (`mu_id`),
  UNIQUE KEY `mu_id_UNIQUE` (`mu_id`)
); 

CREATE TABLE `heart` (
  `h_id` int NOT NULL AUTO_INCREMENT,
  `mu_id` int NOT NULL,
  `m_number` int NOT NULL,
  `h_num` int NOT NULL,
  PRIMARY KEY (`h_id`),
  UNIQUE KEY `h_id_UNIQUE` (`h_id`)
);

create view communityall
as
select DISTINCT
	C.mu_id,Ca.ca_l, S.si_area, C.mu_name, C.mu_detail, M.m_id, C.mu_data , C.mu_c ,
	(select
count(*)
from heart
where heart.mu_id = C.mu_id ) as heart,
(select
count(*)
from comment 
where comment.mu_id =C.mu_id) as comment
from community as C, si_area as S, member as M ,category as Ca
where  C.m_number = M.m_number and M.si_id = S.si_id and Ca.ca_id = C.ca_id;

